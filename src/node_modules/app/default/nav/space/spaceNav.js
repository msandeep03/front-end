import config               from '../../config/api/config'
import spaceNotify          from '../../notify/space/spaceNotify'


export default [
  config.namespace,
  `nav`,
  [
    spaceNotify,
  ],
  () => ({
    path: `/`,
  }),
  {
    pathSet: (getState, setState, methods, { fromNotify }) => function* (pathDirty) {
      const path = pathDirty.replace(`*`, ``)
      yield fromNotify.create({ message: `Redirected to ${path}` })
      yield setState({ path })
    },
    go: (getState) => function* (destination, { history }) {
      let pathname = '/';
      try {
        const { path } = yield getState()
        pathname = `${path}/${destination}`.replace(/\/\/+/g, '/')      
        console.log(`PATHNAME`, pathname)
        history.push({ pathname })
      } catch (err) {
        throw new Error(`DESTINATION ${pathname}`)
      }
    }
  }
]