import React, { Component } from 'react'
import compose              from 'recompose/compose'
import defaultProps         from 'recompose/defaultProps'
import lifecycle            from 'recompose/lifecycle'
import withHandlers         from 'recompose/withHandlers'
import withPropsOnChange    from 'recompose/withPropsOnChange'

import * as THREE           from 'three'


import Context              from '../../scene/all/Context'


const OrbitControls = require('three-orbit-controls')(THREE)

const enhance = compose(
  withHandlers(() => {
    let controls

    return {
      mount: ({
        camera
      }) => () => {
        controls = new OrbitControls(camera)
      },
      unmount: () => () => {
        controls.dispose()
      },
    }
  }),
  lifecycle({
    componentDidMount() {
      console.log(`ControlOrbital3d`, `MOUNT`)
      this.props.mount()
    },
    componentWillUnmount() {
      this.props.unmount()
    }
  }),
)

const ControlOrbital3d = enhance(() => null)

export default (props) => {
  return (
    <Context.Consumer>
      {(context) => (
        <ControlOrbital3d
          {...props}
          fromScene={context}
        />
      )}
    </Context.Consumer>
  )
}